{% extends "base.html" %}

{% block title %}Telegram Bot - Wireguard Manager{% endblock %}

{% block head_scripts %}
    <script src="{{ url_for('static', filename='js/telegram.js') }}" defer></script>
{% endblock %}

{% block content %}
<div class="container">
    <h1 class="mb-4">Telegram Bot Settings</h1>

    <div class="card mb-4">
        <div class="card-header">
            Telegram Bot Configuration
        </div>
        <div class="card-body">
            <form id="telegramConfigForm">
                <div class="mb-3">
                    <label for="botToken" class="form-label">Bot Token</label>
                    <input type="password" class="form-control" id="botToken" name="bot_token" value="{{ telegram_settings.get('bot_token', '') }}" required>
                </div>
                <div class="mb-3">
                    <label for="adminChatIds" class="form-label">Admin Chat IDs (comma-separated)</label>
                    <input type="text" class="form-control" id="adminChatIds" name="admin_chat_ids" value="{{ telegram_settings.get('admin_chat_ids', [])|join(',') }}" required>
                    <small class="form-text text-muted">These users will have admin access to the bot.</small>
                </div>
                <div class="mb-3">
                    <label for="baseUrl" class="form-label">Panel Base URL (for bot API calls)</label>
                    <input type="url" class="form-control" id="baseUrl" name="base_url" value="{{ telegram_settings.get('base_url', '') }}" placeholder="e.g., http://yourdomain.com or http://ip_address:port" required>
                </div>
                 <div class="mb-3">
                    <label for="apiKey" class="form-label">Panel API Key (for bot)</label>
                    <input type="password" class="form-control" id="apiKey" name="api_key" value="{{ telegram_settings.get('api_key', '') }}" required>
                </div>
                <button type="submit" class="btn btn-primary">Save Telegram Settings</button>
            </form>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            Bot Status & Actions
        </div>
        <div class="card-body">
            <p><strong>Bot Status:</strong> <span id="botStatus" class="fw-bold">Unknown</span></p>
            <button class="btn btn-success me-2" id="startBotBtn">Start Bot</button>
            <button class="btn btn-danger me-2" id="stopBotBtn">Stop Bot</button>
            <button class="btn btn-info" id="restartBotBtn">Restart Bot</button>
            <div id="botLogOutput" class="mt-3 p-2" style="background-color: #0A192F; color: #CCD6F6; border: 1px solid #30A5BF; border-radius: 5px; min-height: 100px; max-height: 300px; overflow-y: auto;">
                <!-- Bot logs will appear here -->
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
{% endblock %}